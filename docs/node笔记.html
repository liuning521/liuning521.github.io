<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node 学习笔记 | 学习笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/icon.png">
    <meta name="description" content="个人成长学习记录">
    
    <link rel="preload" href="/assets/css/0.styles.f81279c5.css" as="style"><link rel="preload" href="/assets/js/app.d9fc783e.js" as="script"><link rel="preload" href="/assets/js/3.ef81dcdd.js" as="script"><link rel="preload" href="/assets/js/1.ea232ab5.js" as="script"><link rel="preload" href="/assets/js/20.fdd009f3.js" as="script"><link rel="prefetch" href="/assets/js/10.0cb79c7f.js"><link rel="prefetch" href="/assets/js/11.9d602c52.js"><link rel="prefetch" href="/assets/js/12.6d65e4d9.js"><link rel="prefetch" href="/assets/js/13.f63642b7.js"><link rel="prefetch" href="/assets/js/14.d9886b83.js"><link rel="prefetch" href="/assets/js/15.423c6ba9.js"><link rel="prefetch" href="/assets/js/16.f7c62f10.js"><link rel="prefetch" href="/assets/js/17.3ac29e5a.js"><link rel="prefetch" href="/assets/js/18.7fb632a1.js"><link rel="prefetch" href="/assets/js/19.d33517d1.js"><link rel="prefetch" href="/assets/js/21.7c0153c7.js"><link rel="prefetch" href="/assets/js/22.e4ff5376.js"><link rel="prefetch" href="/assets/js/23.e33e6cab.js"><link rel="prefetch" href="/assets/js/24.bbf85392.js"><link rel="prefetch" href="/assets/js/25.58570ee4.js"><link rel="prefetch" href="/assets/js/26.b2a2ff08.js"><link rel="prefetch" href="/assets/js/27.18bf90d5.js"><link rel="prefetch" href="/assets/js/28.ff42ce52.js"><link rel="prefetch" href="/assets/js/29.68b13caf.js"><link rel="prefetch" href="/assets/js/30.679d0212.js"><link rel="prefetch" href="/assets/js/31.d71b6f7c.js"><link rel="prefetch" href="/assets/js/32.b4904449.js"><link rel="prefetch" href="/assets/js/33.b0bb7acc.js"><link rel="prefetch" href="/assets/js/34.96e0f34c.js"><link rel="prefetch" href="/assets/js/35.72494c3a.js"><link rel="prefetch" href="/assets/js/36.fd6bc0c9.js"><link rel="prefetch" href="/assets/js/37.a1f38912.js"><link rel="prefetch" href="/assets/js/4.6680bd70.js"><link rel="prefetch" href="/assets/js/5.941a4088.js"><link rel="prefetch" href="/assets/js/6.7647fa95.js"><link rel="prefetch" href="/assets/js/7.0d0dbc9c.js"><link rel="prefetch" href="/assets/js/8.4a46f51a.js"><link rel="prefetch" href="/assets/js/9.8479e60f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f81279c5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>学习笔记</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>个人成长学习记录</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>liuning</span>
            
          <span data-v-25ba6db2>2021 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">学习笔记</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/reference/代码规范.html" class="nav-link"><i class="undefined"></i>
  代码规范
</a></div><div class="nav-item"><a href="https://web.qianguyihao.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  前端基础
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://vue3js.cn/interview/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  面试手册
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/liuning66" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><!----> <h3 class="name" data-v-39576ba9>
    liuning
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>26</h3> <h6 data-v-39576ba9>Articles</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>Tags</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/reference/代码规范.html" class="nav-link"><i class="undefined"></i>
  代码规范
</a></div><div class="nav-item"><a href="https://web.qianguyihao.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  前端基础
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://vue3js.cn/interview/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  面试手册
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/liuning66" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <ul class="sidebar-links"><li><a href="/docs/canvas.html" class="sidebar-link">Canvas笔记</a></li><li><a href="/docs/cmd操作.html" class="sidebar-link">Cmd操作</a></li><li><a href="/docs/CSS笔记.html" class="sidebar-link">CSS笔记</a></li><li><a href="/docs/ES6高级.html" class="sidebar-link">ES6高级</a></li><li><a href="/docs/git命令.html" class="sidebar-link">Git命令</a></li><li><a href="/docs/Git笔记.html" class="sidebar-link">Git笔记</a></li><li><a href="/docs/less语法.html" class="sidebar-link">Less</a></li><li><a href="/docs/linux命令.html" class="sidebar-link">Linux命令</a></li><li><a href="/docs/node中间件.html" class="sidebar-link">Node中间件积累</a></li><li><a href="/docs/node笔记.html" class="active sidebar-link">Node 学习笔记</a></li><li><a href="/docs/npm 发布流程.html" class="sidebar-link">发布包至npm</a></li><li><a href="/docs/npm命令.html" class="sidebar-link">npm命令</a></li><li><a href="/docs/react笔记.html" class="sidebar-link">React笔记</a></li><li><a href="/docs/typescript.html" class="sidebar-link">TypeScript学习笔记</a></li><li><a href="/docs/uniapp笔记.html" class="sidebar-link">uniapp笔记</a></li><li><a href="/docs/vue-router笔记.html" class="sidebar-link">vue-router笔记</a></li><li><a href="/docs/vue3笔记.html" class="sidebar-link">vue3笔记</a></li><li><a href="/docs/webpack基础.html" class="sidebar-link">webpack笔记</a></li><li><a href="/docs/响应式布局.html" class="sidebar-link">响应式布局</a></li><li><a href="/docs/正则表达式.html" class="sidebar-link">正则表达式</a></li><li><a href="/docs/网络编程.html" class="sidebar-link">网络编程</a></li><li><a href="/docs/项目笔记.html" class="sidebar-link">项目笔记</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Node 学习笔记</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>liuning</span>
            
          <span data-v-25ba6db2>2021 - </span>
          2022
        </a></span></div></div> <div data-v-130b300a><main class="page" style="padding-right:0;"><section><div class="page-title"><h1 class="title">Node 学习笔记</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>liuning</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h3 id="node热更新"><a href="#node热更新" class="header-anchor">#</a> Node热更新</h3> <div class="language-js extra-class"><pre class="language-js"><code>使用 nodemon 

npm <span class="token operator">-</span>g nodemon

nodemon nodeFile<span class="token punctuation">.</span>js
</code></pre></div><h3 id="导出文件"><a href="#导出文件" class="header-anchor">#</a> 导出文件</h3> <div class="language-js extra-class"><pre class="language-js"><code>一种是通过 module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
引入方式 <span class="token keyword">const</span> test <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span>    
    
<span class="token comment">// exports 是 module.exports 的引用</span>
<span class="token comment">// module.exports = exports;</span>
一种是通过 exports<span class="token punctuation">.</span>xxx <span class="token operator">=</span> yyy 的形式
引入方式 <span class="token keyword">const</span> <span class="token punctuation">{</span>xxx<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
 
</code></pre></div><h3 id="require识别文件"><a href="#require识别文件" class="header-anchor">#</a> require识别文件</h3> <ul><li><p>如果要引用自定义文件的内容 ,一定要用相对路径的方式去写</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> test <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./a.js&quot;</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="title"></p><p>上述代码如果不加 &quot;./&quot;,则require会自动去node_modules模块下去查找</p></div></li> <li><p>如果引入在node_modules中的第三方包，不用加相对路径</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> lodash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;lodash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="title"></p><p>​	引入node_modules中的模块，会默认自动去读取响应模块的index.js文件</p> <p>如果引用的node_modules模块中配置了package.json,那么require将会先去读取package.json中的 main 字段对应的入口文件</p></div></li></ul> <h3 id="node-内置模块"><a href="#node-内置模块" class="header-anchor">#</a> node 内置模块</h3> <p><img src="C:%5CUsers%5C13270%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20211130232514377.png" alt="image-20211130232514377"></p> <h3 id="node-modules特性"><a href="#node-modules特性" class="header-anchor">#</a> node_modules特性</h3> <p>node_modules 会依次往上找，一直找到全局node_modules目录</p> <div class="custom-block tip"><p class="title"></p><p>package.json中的 版本号 &quot;^3.4.1&quot; 代表最低兼容3.4.1版本，3.4.1版本之上的版本都可以使用</p></div><h3 id="fs模块"><a href="#fs模块" class="header-anchor">#</a> fs模块</h3> <p><strong>写入文件</strong></p> <p>使用writeFile方法</p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span>fileContent<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span>fileContent<span class="token punctuation">,</span>fileConfig<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
<span class="token comment">// flag默认为w，操作同一文件时，即后一次执行会覆盖前一次执行的结果</span>
<span class="token literal-property property">fileConfig</span><span class="token operator">:</span><span class="token punctuation">{</span>
   <span class="token literal-property property">flag</span><span class="token operator">:</span><span class="token string">&quot;w&quot;</span> <span class="token comment">// a :追加写入，w：写入，r：读取 </span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>读取文件</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span>fileCode<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
<span class="token literal-property property">fileCode</span><span class="token operator">:</span><span class="token string">&quot;utf8&quot;</span>，<span class="token comment">// 默认为buffer格式</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="title"></p><p>​	所有文件操作没有加Sync都是异步操作，否则都是同步操作</p></div><p><strong>重命名</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span>oldFileName<span class="token punctuation">,</span>newFileName<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
</code></pre></div><p><strong>删除文件</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
</code></pre></div><p><strong>复制</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">copyFile</span><span class="token punctuation">(</span>originFilePath<span class="token punctuation">,</span>targetFilePath<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
</code></pre></div><p><strong>创建文件夹</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
</code></pre></div><p><strong>重命名文件夹</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span>oldDirPath<span class="token punctuation">,</span>newDirPath<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
</code></pre></div><p><strong>读取文件夹</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
</code></pre></div><p><strong>删除文件夹(空文件夹才能删除)</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">rmdir</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
</code></pre></div><p><strong>判断文件/文件夹是否存在</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
</code></pre></div><p><strong>获取文件/文件夹的详细信息</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>stat</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断文件是否是文件夹</span>
    stat<span class="token punctuation">.</span><span class="token function">isDirectory</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
    stat<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>删除非空文件夹</strong></p> <p>先删除文件夹中的文件，然后删除空目录</p> <h3 id="path模块"><a href="#path模块" class="header-anchor">#</a> Path模块</h3> <div class="language-js extra-class"><pre class="language-js"><code>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 将文件路径名称拆开
path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 拿到文件的根目录
path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 获取拓展名  
path<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment">// 组装路径</span>
    root<span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">base</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> 
</code></pre></div><h3 id="异步操作"><a href="#异步操作" class="header-anchor">#</a> 异步操作</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> gen<span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">yield</span> <span class="token string">'1'</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token string">'2'</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token string">'3'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

gen 可以使用 <span class="token keyword">for</span> <span class="token keyword">of</span> 循环执行操作

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span>vlaue<span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`$<span class="token punctuation">{</span>key<span class="token punctuation">}</span><span class="token operator">:</span>$<span class="token punctuation">{</span>value`<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

generate函数的另一种解决方案是 co函数
</code></pre></div><blockquote><p>异步处理的一种解决方案为通过事件的驱动方式去操作，即通过 emit/on 的  形式去操作</p></blockquote> <h3 id="解决异步的几种解决方案"><a href="#解决异步的几种解决方案" class="header-anchor">#</a> 解决异步的几种解决方案</h3> <ul><li>Callback</li> <li>Promise</li> <li>Generate</li> <li>Async/await</li> <li>事件监听方式处理</li></ul> <h3 id="链接mysql"><a href="#链接mysql" class="header-anchor">#</a> 链接mysql</h3> <p>mysql -h localhost -u root -p 123456</p> <h3 id="http"><a href="#http" class="header-anchor">#</a> HTTP</h3> <h5 id="http缓存策略一共有两种"><a href="#http缓存策略一共有两种" class="header-anchor">#</a> http缓存策略一共有两种</h5> <ul><li><p>强缓存策略</p> <p>直接从本地副本对比获取，不去请求服务器，返回状态码是200；使用定时器的方式设置静态资源的有效期，过期缓存自动作废</p> <div class="language-js extra-class"><pre class="language-js"><code>在nodeJS中
Http1<span class="token punctuation">.</span><span class="token number">0</span>写法：
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Expires&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Http1<span class="token punctuation">.</span><span class="token number">1</span>写法：

<span class="token comment">// 20秒后过期，下面的优先级高于上面的</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Cache-Control'</span><span class="token punctuation">,</span><span class="token string">'max-age=20'</span> 
</code></pre></div></li> <li><p>协商缓存</p> <p>expires 和 cache-contorl 都会访问本地缓存直接验证看是否国企，如果没过期直接使用本地缓存，并返回200。但如果设置了no-cache 和 no-store 则本地缓存会被忽略，回去请求服务器验证资源是否更新，如果没更新才继续使用本地缓存，此时返回的是304，这就是协商缓存。协商缓存主要包括last-modified 和 etag</p> <div class="language-js extra-class"><pre class="language-js"><code>res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Cache-Control'</span><span class="token punctuation">,</span><span class="token string">'no-cache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

第一种： last<span class="token operator">-</span>modified <span class="token operator">&amp;</span> <span class="token keyword">if</span><span class="token operator">-</span>modified<span class="token operator">-</span>since

res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'last-modified'</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'if-modified-since'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token number">3</span><span class="token operator">*</span><span class="token number">3000</span> <span class="token operator">&gt;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span><span class="token number">304</span> <span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  
res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>

第二种： eTag <span class="token operator">&amp;</span> <span class="token keyword">if</span><span class="token operator">-</span>none<span class="token operator">-</span>match

<span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;crypto&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> has <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">'sha1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Etag&quot;</span><span class="token punctuation">,</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>headers<span class="token punctuation">[</span><span class="token string">'if-none-match'</span><span class="token punctuation">]</span> <span class="token operator">===</span> hash<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'缓存命中!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">304</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h3 id="i-o处理"><a href="#i-o处理" class="header-anchor">#</a> I/O处理</h3> <p><strong>fs模块</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 同步读取</span>
fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 异步读取</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token keyword">const</span> <span class="token punctuation">{</span>promisify<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;util&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将 fs得readFile 变成promise的方式</span>
<span class="token keyword">const</span> readFile <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>readFile<span class="token punctuation">)</span>

process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 下一次EventLoop执行的时候触发


</code></pre></div><h3 id="buffer缓冲区"><a href="#buffer缓冲区" class="header-anchor">#</a> Buffer缓冲区</h3> <p>作用：为了在nodejs中处理二进制数据</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 开辟一个10个字节的缓冲区</span>
<span class="token keyword">const</span> bf1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token comment">// 创建一个 65kb的文件</span>
<span class="token keyword">const</span> bf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">,</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将 a存到缓冲区中</span>
<span class="token keyword">const</span> bf2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> bf3 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'中文'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 也可以存中文</span>

<span class="token comment">// 将两个buffer合并起来</span>
<span class="token keyword">const</span> bf4 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>bf2<span class="token punctuation">,</span>bf3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 也可以传十六进制组成的数组,下面三个字节组成一个中文</span>
<span class="token keyword">const</span> bf5 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0xe5</span><span class="token punctuation">,</span><span class="token number">0xa4</span><span class="token punctuation">,</span><span class="token number">0xa7</span><span class="token punctuation">,</span><span class="token number">0xa5</span><span class="token punctuation">,</span><span class="token number">0xae</span><span class="token punctuation">,</span><span class="token number">0xb6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 处理乱码问题</span>
<span class="token keyword">const</span> buffer1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0xe5</span><span class="token punctuation">,</span><span class="token number">0xa4</span><span class="token punctuation">,</span><span class="token number">0xa7</span><span class="token punctuation">,</span><span class="token number">0xa5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> buffer2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0xae</span><span class="token punctuation">,</span><span class="token number">0xb6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

直接 buffer1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 或者 buffer2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 会出现乱码

方式一： 通过Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>buffer1<span class="token punctuation">,</span>buffer2<span class="token punctuation">]</span><span class="token punctuation">)</span>组合解决
方式二： 通过 string_decoder库去解决

<span class="token keyword">const</span> <span class="token punctuation">{</span>StringDecoder<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;string_decoder&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> decoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// decoder.write会自动存取多余的乱码，自动跟后面的关联起来</span>
<span class="token keyword">const</span> res1 <span class="token operator">=</span> decoder<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> res2 <span class="token operator">=</span> decoder<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer2<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token operator">+</span>res2<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="http模块"><a href="#http模块" class="header-anchor">#</a> http模块</h3> <p><strong>端口号一共有 65535个， 8000之前的不能滥用，8000之后的随便用</strong></p> <p>创建一个http服务</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// req,res本身是一个流</span>
    res<span class="token punctuation">.</span><span class="token function">writeHeader</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span><span class="token string">&quot;text/plain;charset=utf-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Context-Type&quot;</span><span class="token punctuation">,</span><span class="token string">'text/html'</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>writeHeader可以批量设置头部信息</p> <p>setHeader只能设置一个头部信息</p></blockquote> <p>如果头部请求的是图片 请求头里面会有一个 “image/*”的字段</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>headers<span class="token punctuation">}</span> <span class="token operator">=</span> request<span class="token punctuation">;</span>
<span class="token comment">// 通过判断下面的操作，判断请求的是否是图片</span>
header<span class="token punctuation">.</span>accept<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;image/*&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="流操作"><a href="#流操作" class="header-anchor">#</a> 流操作</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建一个读取流 读取filePath</span>
<span class="token keyword">const</span> rs <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建一个写入流 写入文件路径为 filePath</span>
<span class="token keyword">const</span> ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将读取流的内容写入到写入流中</span>
<span class="token comment">// 即 将rs的内容复制到 ws中</span>
<span class="token comment">// pipe相当于把读取流和写入流连 接起来</span>
rs<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span>

另一种方式是： 
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 流会把数据分成64kb的小文件传输</span>
rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span><span class="token parameter">chunk</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


http请求里面的 req和res也是流

<span class="token comment">// 这样就实现了 文件的返回操作</span>
fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">&quot;./01.jpeg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><img src="/image-20211111231338276.png" alt="image-20211111231338276"></p> <h3 id="编写cli工具"><a href="#编写cli工具" class="header-anchor">#</a> 编写Cli工具</h3> <div class="language-js extra-class"><pre class="language-js"><code>新建一个 bin文件夹
里面新建一个test<span class="token punctuation">.</span>js文件
文件头部声明  #<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node  前面是路径

然后在 <span class="token keyword">package</span><span class="token punctuation">.</span>json中声明

<span class="token string-property property">&quot;bin&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token string">&quot;./bin/test.js&quot;</span>
<span class="token punctuation">}</span>
然后执行 npm link

然后在命令行执行 test命令就可以执行test<span class="token punctuation">.</span>js文件了

书写一个cli

#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node
<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;commander&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 定义 test -v 命令</span>

program<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../package&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>version<span class="token punctuation">)</span>
program<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'init &lt;name&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">&quot;init project&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../lib/init.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 这一句必须要有</span>
program<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>

</code></pre></div><p><strong>编写一个库</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>新建lib文件夹新建init<span class="token punctuation">.</span>js文件

<span class="token keyword">const</span> <span class="token punctuation">{</span>promisify<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;util&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> figlet <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;figlet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 清空命令行</span>
<span class="token keyword">const</span> clear <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clear'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 把输入的日志变成其他颜色</span>
<span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;chalk&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">log</span> <span class="token operator">=</span> <span class="token parameter">content</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>clone<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./download&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 打开浏览器</span>
<span class="token keyword">const</span> open <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">figlet</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span>
    <span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 克隆项目</span>
    <span class="token keyword">await</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token string">&quot;github:su37josephxia/vue-template&quot;</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'安装依赖'</span><span class="token punctuation">)</span>
    <span class="token comment">// cwd是命令行执行的路径</span>
    <span class="token keyword">await</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">'npm.cmd'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'install'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">cwd</span><span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment">// 打开浏览器</span>
    <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8080&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">'npm.cmd'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'run'</span><span class="token punctuation">,</span><span class="token string">'serve'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">cwd</span><span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">function</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 子进程，spawn用于执行命令行命令</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>spawn<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;child_process&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 子进程本身</span>
         <span class="token keyword">const</span> proc <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
         <span class="token comment">// 将子进程的输出流导入到主进程当中</span>
         <span class="token comment">// 不管子进程执行成功还是错误都会把日志导入到主进程中</span>
         <span class="token comment">// process代表当前执行的主进程</span>
         proc<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
         proc<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stderr<span class="token punctuation">)</span><span class="token punctuation">;</span>
         proc<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>



</code></pre></div><p><strong>编写一个类似Vue-Cli的工具</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>promisify<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;util&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// repo 为库的地址，desc目录名称</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function-variable function">clone</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">repo<span class="token punctuation">,</span>desc</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 为了下载git上的资源</span>
    <span class="token keyword">const</span> download <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;dolwnload-git-repo &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 进度条</span>
    <span class="token keyword">const</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ora&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> process <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token string">&quot;下载...&quot;</span><span class="token operator">+</span>repo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">download</span><span class="token punctuation">(</span>repo<span class="token punctuation">,</span>desc<span class="token punctuation">)</span>
    process<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="自动生成代码"><a href="#自动生成代码" class="header-anchor">#</a> 自动生成代码</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 根据代码模板生成模板</span>
<span class="token keyword">const</span> handlebars <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;handlebars&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;chalk&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果文件嵌套就需要递归</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span><span class="token string">'./src/views'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> v<span class="token operator">!==</span> <span class="token string">&quot;Home.vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span>v<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;.vue&quot;</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">file</span><span class="token operator">:</span>v
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>；
   <span class="token comment">// 生成路由定义 compile({list},'./src/routers.js',&quot;./template/router.js.hbs&quot;);</span>
    
    <span class="token comment">// 生成菜单</span>
    <span class="token function">compile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>list<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">'./src/App.vue'</span><span class="token punctuation">,</span><span class="token string">&quot;./template/App.vue.hbs&quot;</span><span class="token punctuation">)</span> 
    
    <span class="token comment">// meta 数据定义 </span>
    <span class="token comment">// filePath 目标文件路径</span>
    <span class="token comment">// templatePath 模板文件路径</span>
    <span class="token keyword">function</span> <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">meta<span class="token punctuation">,</span>filePath<span class="token punctuation">,</span>templatePath</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> result <span class="token operator">=</span> handlebars<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">(</span>meta<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token string">&quot;创建成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>  
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/image-20211117235735222.png" alt="image-20211117235735222"></p> <p><img src="/image-20211117235807851.png" alt="image-20211117235807851"></p> <p><img src="/image-20211118000332974.png" alt="image-20211118000332974"></p> <p><strong>热更新代码</strong></p> <p><img src="/image-20211118000823399.png" alt="image-20211118000823399"></p> <p><strong>promisify源码</strong></p> <p><img src="/image-20211118000945998.png" alt="image-20211118000945998"></p> <h3 id="koa2的使用"><a href="#koa2的使用" class="header-anchor">#</a> Koa2的使用</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>url <span class="token comment">// 访问的url地址</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token number">123</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">21</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 执行下一个中间件</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>::: info</p> <p>可以把复杂的问题通过分层的思想去解决</p> <p>可以通过对象的get set方法把获取复杂对象属性值的过程给简化</p> <p>:::</p> <h3 id="koa中间件"><a href="#koa中间件" class="header-anchor">#</a> Koa中间件</h3> <p><strong>koa-router</strong></p> <p>**koa-static **</p> <div class="language-js extra-class"><pre class="language-js"><code>洋葱圈模式实现的 组合函数方法用到的式设计模式中的责任链模式
</code></pre></div></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/docs/node中间件.html" class="prev">
            Node中间件积累
          </a></span> <span class="next"><a href="/docs/npm 发布流程.html">
            发布包至npm
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:0;" data-v-cb1513f6></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.d9fc783e.js" defer></script><script src="/assets/js/3.ef81dcdd.js" defer></script><script src="/assets/js/1.ea232ab5.js" defer></script><script src="/assets/js/20.fdd009f3.js" defer></script>
  </body>
</html>
